{% extends "base.html" %}
{% block content %}
<main class="px-8 py-8 max-w-7xl mx-auto">
  <h2 class="font-extrabold text-2xl leading-7 mb-1">Products</h2>
  <p class="text-slate-600 mb-6 max-w-xl">
    Manage your products and update cost prices for accurate profit calculations.
  </p>

  <form method="post" action="{{ url_for('products.update_cost') }}">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
      <label for="search" class="relative block w-full sm:w-auto">
        <input
          id="search"
          type="search"
          placeholder="Search products..."
          class="pl-10 pr-4 py-2 border border-slate-300 rounded-md text-sm text-slate-700 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-400 focus:border-transparent w-full sm:w-56"
        />
        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm pointer-events-none"></i>
      </label>
      <div class="mt-3 sm:mt-0 text-slate-600 text-sm">{{ products|length }} products</div>
    </div>

    <table class="w-full border-collapse text-sm text-slate-900">
      <thead>
        <tr class="border-b border-slate-300 text-left">
          <th class="pb-3 font-semibold px-3">Product Name</th>
          <th class="pb-3 font-semibold px-3">Cost Price</th>
          <th class="pb-3 font-semibold px-3">Total Orders</th>
          <th class="pb-3 font-semibold px-3">Update</th>
        </tr>
      </thead>
      <tbody>
        {% for p in products %}
        <tr class="border-b border-slate-200">
          <td class="py-4 px-3 font-semibold">{{ p.product_name }}</td>
          <td class="py-4 px-3">
            <div class="flex items-center space-x-2 max-w-[200px]">
              <input
                type="number"
                name="cost_price_{{ loop.index }}"
                value="{{ p.cost_price or '' }}"
                min="0"
                step="0.1"
                class="w-full text-sm text-slate-900 border border-slate-900 rounded-md py-1 px-2 appearance-textfield focus:outline-none focus:ring-2 focus:ring-slate-900 focus:border-transparent"
              />
              <input type="hidden" name="product_name_{{ loop.index }}" value="{{ p.product_name }}">
            </div>
          </td>
          <td class="py-4 px-3">
            <span class="inline-block border border-slate-300 rounded-full px-3 py-0.5 text-xs text-slate-600 select-none">
              {{ p.total_orders }}
            </span>
          </td>
          <td class="py-4 px-3">
            <button
              type="submit"
              name="row_index"
              value="{{ loop.index }}"
              class="inline-flex items-center space-x-2 border border-slate-300 rounded-md px-3 py-1 text-sm text-slate-700 hover:bg-slate-50"
            >
              <i class="fas fa-check"></i>
              <span>Save</span>
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </form>
</main>
{% endblock %}
